// -*- mode: js -*-

// define tamaro widgets
const RNW = <%= forms %>;

// initialize all tamaro widgets defined in RNW
$(() => {
  Object.keys(RNW).forEach(key => {
    const selector = '#'+key;
    const options = RNW[key];
    // console.log('initialize', selector, 'with', options);
    // check if it exists
    if ($(selector).length) {
      window.rnw.tamaro.runWidget(selector, options);
    } else {
      // console.log(selector, "not found.");
    }
  });

  // const json = window.location.hash.match(/#rn(.+)/)[1];
  // if (json) {
  //   const details = JSON.parse(json);
  //   console.log(details);
  //   // rnw.tamaro.instance.paymentForm.
  // }

  const beforePaymentSendHandler = (event) => {
    const api = event.data.api;
    window.api = api;
    console.log("Amount is", api.paymentForm.data.amount);
    console.log("Campaign id is", api.paymentForm.data.stored_campaign_id);
    console.log("Campaign subid is", api.paymentForm.data.stored_campaign_subid);
  }

  window.rnw.tamaro.events.beforePaymentSend.subscribe(beforePaymentSendHandler);
});
